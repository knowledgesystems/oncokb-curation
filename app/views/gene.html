<div ng-show="loaded" ng-if="gene" class="geneMainDiv">
  <div id="gene">
    <h2>
      <!-- Gene: <span>{{gene.name.text}}</span> -->
      Gene: <span contenteditable="{{fileEditable}}" ng-model="gene.name.text"></span><comments-dict gene-name="{{gene.name.text}}"file-editable="fileEditable" comments="gene.name_comments" object="gene" key="name" add-comment="addComment(arg1,arg2,arg3)"></comments-dict>
      <span ng-repeat="collaborator in collaborators">
        <img style="height:30px" ng-src="{{collaborator.photoUrl}}" tooltip-placement="top" tooltip="{{collaborator.displayName}}">
      </span>
      <span ng-if="document" class="geneLastModify">Last edit was made on {{document.modifiedDate | date : 'MMM d, h:mm a'}} by {{document.lastModifyingUserName}}</span>
      <span class="btn-group pull-right" role="group">
        <button type="button" class="btn btn-default" ng-disabled="!canUndo" ng-click="undo()">Undo</button>
        <button type="button" class="btn btn-default" ng-disabled="!canRedo" ng-click="redo()">Redo</button>
        <button type="button" class="btn btn-default" ng-click="generatePDF()">Download PDF</button>
        <button type="button" class="btn btn-default" ng-click="isOpenFunc('expand')">Expand all</button>
        <button type="button" class="btn btn-default" ng-click="isOpenFunc('collapse')">Collapse all</button>
      </span>
    </h2>
    <p ng-if="gene.curators && gene.curators.asArray().length > 0">
      <span><strong>Curator name: <span ng-bind="curatorsName()"></span></strong></span><br/>
      <span><strong>Curator email: <span ng-bind="curatorsEmail()"></span></strong></span>
    </p>
    <p ng-if="userRole === 8">
      <strong>Status:</strong>
      <span ng-repeat="checkbox in checkboxes['geneStatus']">
        <input
                id="{{gene.name.text}}-gene-status-box{{$index}}"
                type="checkbox"
                ng-model="gene.status.text"
                ng-true-value="{{checkbox}}"
                ng-false-value=""
                ng-change="setGeneStatus()"
                >
        <label for="{{gene.name.text}}-gene-status-box{{$index}}">{{checkbox}}</label>
      </span>
    </p>
    <h3>{{gene.summary.display}}:<comments-dict file-editable="fileEditable" comments="gene.summary_comments" object="gene" key="summary" gene-name="{{gene.name.text}}" add-comment="addComment(arg1,arg2,arg3)"></comments-dict></h3>
    <p class="doubleH" ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="gene.summary.text"></p>
    <h3>{{gene.background.display}}:<comments-dict file-editable="fileEditable" comments="gene.background_comments" object="gene" gene-name="{{gene.name.text}}" key="background" add-comment="addComment(arg1,arg2,arg3)"></comments-dict></h3>
    <p class="doubleH" ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="gene.background.text"></p>
    <pub-iframe ng-model="gene.background.text"></pub-iframe>
    <div ng-if="gene.name.text">
      <table class="table geneLinks">
        <tbody>
        <tr>
          <td>cBioPortal link: </td>
          <td><a href="http://www.cbioportal.org/ln?q={{gene.name.text}}" target="_blank">http://www.cbioportal.org/ln?q={{gene.name.text}}</a></td>
        </tr>
        <tr>
          <td>COSMIC link: </td>
          <td><a href="http://cancer.sanger.ac.uk/cosmic/gene/overview?ln={{gene.name.text}}" target="_blank">http://cancer.sanger.ac.uk/cosmic/gene/overview?ln={{gene.name.text}}</a></td>
        </tr>
        <tr>
          <td>
            <span ng-if="pubMedLinks && pubMedLinksLength > 1">PubMed links:</span>
            <span ng-if="pubMedLinks && pubMedLinksLength === 1">PubMed link:</span>
          </td>
          <td>
            <div ng-if="pubMedLinks.gene.length > 0">
              <span style="font-size: 13px;font-weight: bold;">Gene:</span>
              <ul>
                <li ng-repeat="link in pubMedLinks.gene"><a href="{{link}}" target="_blank">{{link}}</a></li>
              </ul>
            </div>
            <div class="geneLinkDiv" ng-if="pubMedMutationLinksLength > 0">
              <span><span ng-show="pubMedMutationLinksLength > 2"><i ng-click="expand = !(!!expand)" class="fa" ng-class="{'fa-chevron-down': !!expand, 'fa-chevron-right':!(!!expand)}"></i> {{pubMedMutationLength}} m</span><span ng-if="pubMedMutationLinksLength <=2">M</span>utation<span ng-if="pubMedMutationLinksLength > 1">s</span></span>
              <div ng-show="!!expand || pubMedMutationLinksLength <= 2">
                <div ng-repeat="(key, value) in pubMedLinks.mutations">
                  <span>{{key}}</span>
                  <ul>
                    <li ng-repeat="link in value"><a href="{{link}}" target="_blank">{{link}}</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </td>
        </tr>
        </tbody>
      </table>


    </div>
  </div>
  <div id="mutation">
    <accordion close-others="oneAtATime">
      <accordion-group ng-init="mutationIndex = $index; geneStatus[mutationIndex] = {}; geneStatus[mutationIndex].isOpen=false; geneStatus[mutationIndex].oncogenic = false; geneStatus[mutationIndex] = {}" is-open="geneStatus[mutationIndex].isOpen" ng-repeat="mutation in gene.mutations.asArray()" class="levelOneHeader">
        <accordion-heading >
          <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[mutationIndex].isOpen, 'fa-chevron-right': !geneStatus[mutationIndex].isOpen}"></i>
          <span ng-click="stopCollopse($event)">Mutation: </span><span ng-click="stopCollopse($event)" ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="mutation.name.text"/></span><comments-dict mutation="{{mutation.name.text}}" gene-name="{{gene.name.text}}" ng-click="commentClick($event)" file-editable="fileEditable" comments="mutation.name_comments" object="mutation" key="name" add-comment="addComment(arg1,arg2,arg3)"></comments-dict>
            <span class="pull-right" ng-show="fileEditable">
              <span style="margin-right: 20px">
                <i class="fa fa-angle-up" ng-if="$index !== 0" ng-click="move(gene.mutations, $index, $index, $event)"></i>
                <i class="fa fa-angle-down" ng-if="$index !== gene.mutations.length-1" ng-click="move(gene.mutations, $index, $index+2, $event)"></i>
                <i class="fa fa-angle-double-up" ng-if="$index > 1" ng-click="move(gene.mutations, $index, 0, $event)"></i>
                <i ng-if="$index < gene.mutations.length-2" class="fa fa-angle-double-down" ng-click="move(gene.mutations, $index, gene.mutations.length, $event)"></i>
              </span>
              <i ng-click="remove($index, gene.mutations, $event)" class="fa fa-trash-o"></i>
            </span>
        </accordion-heading>
        <accordion close-others="oneAtATime">
          <!-- Mutation Effect -->
          <accordion-group ng-init="geneStatus[mutationIndex].oncogenic = {}" is-open="geneStatus[mutationIndex].oncogenic.isOpen" class="levelTwoHeader">
            <accordion-heading>
              <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[mutationIndex].oncogenic.isOpen, 'fa-chevron-right': !geneStatus[mutationIndex].oncogenic.isOpen}" ng-click="changeIsOpen(geneStatus[mutationIndex].oncogenic.isOpen)"></i>
              <span ng-click="stopCollopse($event)"> Mutation effect</span><span ng-click="stopCollopse($event)" class="curationNoEntry" ng-if="mutation.oncogenic.text === '' && mutation.effect.value.text === '' && mutation.description.text === ''">No Entry</span><comments-dict mutation="{{mutation.name.text}}" file-editable="fileEditable" gene-name="{{gene.name.text}}" comments="mutation.oncogenic_comments" object="mutation" key="oncogenic" ng-click="commentClick($event)" add-comment="addComment(arg1,arg2,arg3)"></comments-dict>
            </accordion-heading>
            <p>
              <strong>{{mutation.oncogenic.display}}:</strong>
                <span ng-repeat="checkbox in checkboxes['oncogenic']">
                  <input
                          id="{{mutation.name.text}}-oncogenic-box{{$index}}"
                          type="checkbox"
                          ng-model="mutation.oncogenic.text"
                          ng-true-value="{{checkbox}}"
                          ng-false-value=""
                          >
                  <label for="{{mutation.name.text}}-oncogenic-box{{$index}}">{{checkbox}}</label>
                </span>
            </p>
            <div class="mutationEffect">
              <strong class="header">Mutation effect:</strong>
              <div class="content">
                  <span  ng-repeat="checkbox in checkboxes['mutation_effect']">
                    <input
                            id="{{mutation.name.text}}-mutation_effect-box{{$index}}"
                            type="checkbox"
                            ng-change="mutationEffectChanged(mutation.effect)"
                            ng-model="mutation.effect.value.text"
                            ng-true-value="{{checkbox}}"
                            ng-false-value=""
                            >
                    <label for="{{mutation.name.text}}-mutation_effect-box{{$index}}">{{checkbox}}</label>
                    <input type='text' ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-if="mutation.effect.value.text === checkbox && checkbox !== 'Other'" ng-model="mutation.effect.addOn.text" placeholder=" Optional text"/>
                    <input type='text' ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-if="mutation.effect.value.text === checkbox && checkbox === 'Other'" ng-model="mutation.effect.addOn.text"/>
                  </span>
              </div>
            </div>
              <span>
                <strong>{{mutation.description.display}}:</strong>
                <br/>
                <p class="doubleH" ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="mutation.description.text"></p>
              </span>
            <pub-iframe ng-model="mutation.description.text"></pub-iframe>
          </accordion-group>
          <!-- tumor types -->
          <accordion-group ng-init="tumorIndex=$index; geneStatus[mutationIndex][tumorIndex] = {}; geneStatus[mutationIndex][tumorIndex].isOpen = false; " is-open="geneStatus[mutationIndex][tumorIndex].isOpen" class="levelTwoHeader" ng-repeat="tumor in mutation.tumors.asArray()">
            <accordion-heading >
              <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[mutationIndex][tumorIndex].isOpen, 'fa-chevron-right': !geneStatus[mutationIndex][tumorIndex].isOpen}"></i>
              <span ng-click="stopCollopse($event)">Tumor type: </span>
              <span ng-click="stopCollopse($event)" ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="tumor.name.text"/></span><comments-dict mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" gene-name="{{gene.name.text}}"file-editable="fileEditable" comments="tumor.name_comments" object="tumor" key="name" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)"></comments-dict>
                <span class="pull-right" ng-show="fileEditable">
                  <span style="margin-right: 20px">
                    <i class="fa fa-angle-up" ng-if="$index !== 0" ng-click="move(mutation.tumors, $index, $index, $event)"></i>
                    <i class="fa fa-angle-down" ng-if="$index !== mutation.tumors.length-1" ng-click="move(mutation.tumors, $index, $index+2, $event)"></i>
                    <i class="fa fa-angle-double-up" ng-if="$index > 1" ng-click="move(mutation.tumors, $index, 0, $event)"></i>
                    <i ng-if="$index < mutation.tumors.length-2" class="fa fa-angle-double-down" ng-click="move(mutation.tumors, $index, mutation.tumors.length, $event)"></i>
                  </span>
                  <i ng-click="remove($index, mutation.tumors, $event)" class="fa fa-trash-o pull-right"></i>
                </span>
            </accordion-heading>

            <accordion close-others="oneAtATime">
              <!-- Prevalence -->
              <accordion-group ng-init="geneStatus[mutationIndex][tumorIndex].prevalence={}; geneStatus[mutationIndex][tumorIndex].prevalence.isOpen = false" is-open="geneStatus[mutationIndex][tumorIndex].prevalence.isOpen" class="levelThreeHeader">
                <accordion-heading>
                  <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[mutationIndex][tumorIndex].prevalence.isOpen, 'fa-chevron-right': !geneStatus[mutationIndex][tumorIndex].prevalence.isOpen}" ng-click="changeIsOpen(geneStatus[mutationIndex][tumorIndex].isOpen)"></i>
                  <span ng-click="stopCollopse($event)">{{tumor.prevalence.display}}: </span>
                  <span class="curationNoEntry" ng-click="stopCollopse($event)" ng-if="tumor.prevalence.text === ''">No Entry</span><comments-dict mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" gene-name="{{gene.name.text}}" file-editable="fileEditable" comments="tumor.prevalence_comments" object="tumor" key="prevalence" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)"></comments-dict>
                </accordion-heading>
                <p class="doubleH" ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="tumor.prevalence.text"></p>
                <pub-iframe ng-model="tumor.prevalence.text"></pub-iframe>
              </accordion-group>

              <!-- Prognostic implications -->
              <accordion-group ng-init="geneStatus[mutationIndex][tumorIndex].progImp={}; geneStatus[mutationIndex][tumorIndex].progImp.isOpen = false" is-open="geneStatus[mutationIndex][tumorIndex].progImp.isOpen" class="levelThreeHeader">
                <accordion-heading>
                  <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[mutationIndex][tumorIndex].progImp.isOpen, 'fa-chevron-right': !geneStatus[mutationIndex][tumorIndex].progImp.isOpen}" ng-click="changeIsOpen(geneStatus[mutationIndex][tumorIndex].progImp.isOpen)"></i>
                  <span ng-click="stopCollopse($event)">{{tumor.progImp.display}}: </span>
                  <span  ng-click="stopCollopse($event)"class="curationNoEntry" ng-if="tumor.progImp.text === ''">No Entry</span><comments-dict mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" gene-name="{{gene.name.text}}"file-editable="fileEditable" comments="tumor.progImp_comments" object="tumor" key="progImp" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)"></comments-dict>
                </accordion-heading>
                <p class="doubleH" ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="tumor.progImp.text"></p>
                <pub-iframe ng-model="tumor.progImp.text"></pub-iframe>
              </accordion-group>

              <!-- NCCN guidelines -->
              <accordion-group ng-init="geneStatus[mutationIndex][tumorIndex].nccn={}; geneStatus[mutationIndex][tumorIndex].nccn.isOpen = false" is-open="geneStatus[mutationIndex][tumorIndex].nccn.isOpen" class="levelThreeHeader">
                <accordion-heading>
                  <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[mutationIndex][tumorIndex].nccn.isOpen, 'fa-chevron-right': !geneStatus[mutationIndex][tumorIndex].nccn.isOpen}" ng-click="changeIsOpen(geneStatus[mutationIndex][tumorIndex].nccn.isOpen)"></i>
                  <span ng-click="stopCollopse($event)">NCCN guidelines: </span>
                  <span ng-click="stopCollopse($event)" class="curationNoEntry" ng-if="tumor.nccn.disease.text === '' || tumor.nccn.disease.text === 'NA'">No Entry</span><comments-dict display-name="NCCN guidelines" mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" gene-name="{{gene.name.text}}" file-editable="fileEditable" comments="tumor.nccn_comments" object="tumor" key="nccn" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)"></comments-dict>
                </accordion-heading>
                <p>
                  <strong>{{tumor.nccn.therapy.display}}:</strong>
                  <input type='text' ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="tumor.nccn.therapy.text"/>
                </p>
                <p>
                  <strong>{{tumor.nccn.disease.display}}:</strong>
                  <select chosen id="CurationNCCNDropDown" allow-single-deselect="true" ng-model="tumor.nccn.disease.text" ng-options="opt for opt in nccnDiseaseTypes">
                    <option value="NA"></option>
                  </select>
                </p>
                <p>
                  <strong>{{tumor.nccn.version.display}}:</strong>
                  <input type='text' ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="tumor.nccn.version.text"/>
                </p>
                <p>
                  <strong>{{tumor.nccn.pages.display}}:</strong>
                  <input type='text' ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="tumor.nccn.pages.text"/>
                </p>
                <p>
                  <strong>{{tumor.nccn.category.display}}:</strong>
                  <select style="width: 100%" ng-model="tumor.nccn.category.text" ng-options="opt.value as opt.label for opt in nccnCategories"></select>
                </p>
                    <span>
                      <strong>{{tumor.nccn.description.display}}:</strong>
                          <br/>
                      <p class="doubleH" ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="tumor.nccn.description.text">
                      </p>
                    </span>
                <pub-iframe ng-model="tumor.nccn.description.text"></pub-iframe>
              </accordion-group>

              <!-- Theraputic implications -->
              <accordion-group is-open="geneStatus[mutationIndex][tumorIndex][tiIndex].isOpen" ng-init="tiIndex = $index; geneStatus[mutationIndex][tumorIndex][tiIndex] = {}; geneStatus[mutationIndex][tumorIndex][tiIndex].isOpen = false;" class="levelThreeHeader" ng-repeat="ti in tumor.TI.asArray()">
                <accordion-heading>
                  <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[mutationIndex][tumorIndex][tiIndex].isOpen, 'fa-chevron-right': !geneStatus[mutationIndex][tumorIndex][tiIndex].isOpen}" ng-click="changeIsOpen(geneStatus[mutationIndex][tumorIndex][tiIndex].isOpen)"></i>
                  <span ng-click="stopCollopse($event)">{{ti.name.text}}: </span>
                  <span ng-click="stopCollopse($event)" class="curationNoEntry" ng-if="ti.description.text === '' && ti.treatments.length === 0">No Entry</span>
                  <comments-dict display-name="{{ti.name.text}}" mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" gene-name="{{gene.name.text}}" file-editable="fileEditable" comments="ti.name_comments" object="ti" key="name" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)"></comments-dict>
                </accordion-heading>
                  <span>
                    <p ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" placeholder="Optional general summary" ng-model="ti.description.text"></p>
                  </span>
                <pub-iframe ng-model="ti.description.text"></pub-iframe>
                <accordion close-others="oneAtATime">
                  <accordion-group ng-init="treatmentIndex = $index; geneStatus[mutationIndex][tumorIndex][tiIndex][treatmentIndex]={}; geneStatus[mutationIndex][tumorIndex][tiIndex][treatmentIndex].isOpen = false;" is-open="geneStatus[mutationIndex][tumorIndex][tiIndex][treatmentIndex].isOpen" class="levelFourHeader" ng-repeat="treatment in ti.treatments.asArray()">
                    <accordion-heading>
                      <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[mutationIndex][tumorIndex][tiIndex][treatmentIndex].isOpen, 'fa-chevron-right': !geneStatus[mutationIndex][tumorIndex][tiIndex][treatmentIndex].isOpen}"></i>
                      <span ng-click="stopCollopse($event)">{{treatment.type.text}}: </span>
                      <span ng-click="stopCollopse($event)" ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="treatment.name.text"/></span><comments-dict gene-name="{{gene.name.text}}" therapy="{{treatment.name.text}}" mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" parent-event="$event" file-editable="fileEditable" comments="treatment.name_comments" object="treatment" key="name" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)"></comments-dict>
                              <span class="pull-right" ng-show="fileEditable">
                                <span style="margin-right: 20px">
                                  <i class="fa fa-angle-up" ng-if="$index !== 0" ng-click="move(ti.treatments, $index, $index, $event)"></i>
                                  <i class="fa fa-angle-down" ng-if="$index < ti.treatments.length-2" ng-click="move(ti.treatments, $index, $index+2, $event)"></i>
                                  <i class="fa fa-angle-double-up" ng-if="$index > 1" ng-click="move(ti.treatments, $index, 0, $event)"></i>
                                  <i ng-if="$index !== ti.treatments.length-1" class="fa fa-angle-double-down" ng-click="move(ti.treatments, $index, ti.treatments.length, $event)"></i>
                                </span>
                                <i ng-click="remove($index, ti.treatments, $event)" class="fa fa-trash-o"></i>
                              </span>
                    </accordion-heading>
                    <p>
                      <strong>{{treatment.level.display}}:</strong>
                            <span ng-if="checkTI(ti, 1, 1)">
                              <select style="width: 90%" ng-model="treatment.level.text"
                                      ng-options="opt.value as opt.label for opt in levels.SS">
                              </select>
                            </span>
                            <span ng-if="checkTI(ti, 1, 0)">
                              <select style="width: 95%"  ng-model="treatment.level.text"
                                      ng-options="opt.value as opt.label for opt in levels.SR">
                              </select>
                              <i class="fa fa-question-circle" style="color: grey;" tooltip-placement="top" tooltip-html-unsafe="{{levelExps.SR}}"></i>
                            </span>
                            <span ng-if="checkTI(ti, 0, 1)">
                              <select style="width: 100%" ng-model="treatment.level.text"
                                      ng-options="opt.value as opt.label for opt in levels.IS">
                              </select>
                            </span>
                            <span ng-if="checkTI(ti, 0, 0)">
                              <select style="width: 95%" ng-model="treatment.level.text"
                                      ng-options="opt.value as opt.label for opt in levels.IR">
                              </select>
                              <i class="fa fa-question-circle" style="color: grey;" tooltip-placement="top" tooltip-html-unsafe="{{levelExps.IR}}"></i>
                            </span>
                    </p>
                    <div class="approvedIndication" ng-if="checkTI(ti, 1, 1)">
                      <div class="header">
                        <strong>{{treatment.indication.display}}:</strong>
                      </div>
                      <div class="content">
                        <p type='text' ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="treatment.indication.text"></p>
                        <pub-iframe ng-model="treatment.indication.text"></pub-iframe>
                      </div>
                    </div>
                      <span>
                        <strong>{{treatment.description.display}}:</strong>
                        <br/>
                        <p class="doubleH" ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="treatment.description.text">
                        </p>
                        <pub-iframe ng-model="treatment.description.text"></pub-iframe>
                      </span>
                  </accordion-group>
                </accordion>
                <div class="input-group input-group-sm">
                  <input type="text" class="form-control" ng-model="newTIName" placeholder="Therapy name" />
                    <span class="input-group-btn">
                      <button type="button" class="btn btn-default" ng-disabled="!(!!newTIName)" ng-click="addTI(ti, $index, newTIName, mutationIndex, tumorIndex, tiIndex); newTIName=''">
                        <i class="fa fa-plus"></i> Add Therapy and {{ti.types.get('status').toString() === '0'?'Investigational': 'Standard'}} implications
                      </button>
                    </span>
                </div>
              </accordion-group>

              <!-- Trials -->
              <accordion-group ng-init="geneStatus[mutationIndex][tumorIndex].trials={}; geneStatus[mutationIndex][tumorIndex].trials.isOpen = false" is-open="geneStatus[mutationIndex][tumorIndex].trials.isOpen" class="levelThreeHeader">
                <accordion-heading>
                  <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[mutationIndex][tumorIndex].trials.isOpen, 'fa-chevron-right': !geneStatus[mutationIndex][tumorIndex].trials.isOpen}" ng-click="changeIsOpen(geneStatus[mutationIndex][tumorIndex].trials.isOpen)"></i>
                  <span ng-click="stopCollopse($event)">Ongoing clinical trials: </span>
                  <span ng-click="stopCollopse($event)" class="curationNoEntry" ng-if="tumor.trials.length === 0">No Entry</span><comments-dict display-name="Ongoing clinical trials" mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" gene-name="{{gene.name.text}}"file-editable="fileEditable" comments="tumor.trials_comments" object="tumor" key="trials" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)"></comments-dict>
                </accordion-heading>
                <div>
                    <span class="curateTrialItem" ng-repeat="trial in tumor.trials.asArray()">
                    <a ng-href="https://clinicaltrials.gov/show/{{trial}}" target="_blank">{{trial}}</a>
                    <i ng-show="fileEditable" ng-click="remove($index, tumor.trials, $event)" class="fa fa-trash-o"></i>
                    </span>
                  <div class="input-group input-group-sm trialsInputGroup">
                    <input type="text" class="form-control" ng-model="newTrial" placeholder="Trial ID" />
                      <span class="input-group-btn">
                        <button type="button" class="btn btn-default" ng-disabled="!(!!newTrial)" ng-click="addTrial(tumor.trials, newTrial); newTrial=''">
                          <i class="fa fa-plus"></i> Add Trial
                        </button>
                        <!-- <button type="button" class="btn btn-default" ng-if="userRole === 8" ng-click="cleanTrial(tumor.trials)">
                          <i class="fa fa-plus"></i> Clean Trial
                        </button> -->
                      </span>
                  </div>
                </div>
              </accordion-group>
            </accordion>
            <!-- <hr/>
                      <h4>Interacting alterations:</h4>
                      <p>
                  <strong><comments-dict file-editable="fileEditable" comments="tumor.interactAlts.alterations_comments" object="tumor.interactAlts" key="alterations" add-comment="addComment(arg1,arg2,arg3)"></comments-dict>{{tumor.interactAlts.alterations.display}}:</strong>
                  <input type='text' ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="tumor.interactAlts.alterations.text"/>
            </p>
            <span>
                  <strong><comments-dict file-editable="fileEditable" comments="tumor.interactAlts.description_comments" object="tumor.interactAlts" key="description" add-comment="addComment(arg1,arg2,arg3)"></comments-dict>{{tumor.interactAlts.description.display}}:</strong>
                  <p class="doubleH" type='text' ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="tumor.interactAlts.description.text"></p>
            </span> -->
          </accordion-group>
        </accordion>
        <div style="width: 100%" class="input-group input-group-sm">
          <input type="text" ng-model="newTumorTypeName" typeahead="tumorType for tumorType in tumorTypes | typeaheadFilter:$viewValue | limitTo: 10" class="form-control" placeholder="Free text or choose from the dropdown list">
          <span class="input-group-btn">
            <button type="button" class="btn btn-default" ng-disabled="!(!!newTumorTypeName)" ng-click="addTumorType(mutation, newTumorTypeName, mutationIndex); newTumorTypeName=''">
              <i class="fa fa-plus"></i> Add Tumor Type
            </button>
          </span>
        </div>
      </accordion-group>
    </accordion>
  </div>
  <div class="input-group input-group-sm">
    <input type="text" class="form-control" ng-model="newMutationName" placeholder="{{addMutationPlaceholder}}"  typeahead="suggestedMutation for suggestedMutation in suggestedMutations | filter:$viewValue:stateComparator" empty-typeahead  ng-click="opened=!opened" focus-me="opened" ng-focus="onFocus($event)" />
    <span class="input-group-btn">
      <button type="button" class="btn btn-default" ng-disabled="!(!!newMutationName)" ng-click="addMutation(newMutationName); newMutationName=''">
        <i class="fa fa-plus"></i> Add Mutation
      </button>
    </span>
  </div>
</div>
<div ng-show="loaded" class="floatToolBox btn-group btn-group-sm" role="group">
  <span class="btn btn-default" style="opacity: 1" disabled>{{gene.name.text}}</span>
  <button type="button" class="btn btn-default" ng-disabled="!canUndo" ng-click="undo()">Undo</button>
  <button type="button" class="btn btn-default" ng-disabled="!canRedo" ng-click="redo()">Redo</button>
  <button type="button" class="btn btn-default" ng-click="generatePDF()">Download PDF</button>
  <button type="button" class="btn btn-default" ng-click="isOpenFunc('expand')">Expand all</button>
  <button type="button" class="btn btn-default" ng-click="isOpenFunc('collapse')">Collapse all</button>
  <button type="button" class="btn btn-default" ng-if="userRole === 8" ng-click="getData()">Check gene data</button>
  <button type="button" class="btn btn-default" ng-if="userRole === 8" ng-click="updateGene()"><span ng-show="!!!docStatus.savedGene"><i class="fa fa-spinner fa-spin"></i></span><span ng-show="!!docStatus.savedGene">Update gene</span></button>
  <button type="button" class="btn btn-default" ng-if="userRole === 8" ng-click="getComments()">Check comments</button>
  <button type="button" class="btn btn-default" ng-if="userRole === 8" ng-click="checkScope()">Check Scope</button>
  <span class="btn btn-default" disabled><span ng-show="docStatus.saving">Saving <i class="fa fa-spinner fa-spin"></i></span><span ng-show="docStatus.saved">All changes saved</span><span style="color: red; font-weight: bold;" ng-show="docStatus.closed">Error saving the changes, please refresh the page</span></span>
</div>
<div ng-hide="loaded" class="genesLoading">
  <div class='sk-spinner sk-spinner-wave mskcc'>
    <div class='sk-rect1'></div>
    <div class='sk-rect2'></div>
    <div class='sk-rect3'></div>
    <div class='sk-rect4'></div>
    <div class='sk-rect5'></div>
  </div>
  Please wait, we are loading gene information.
</div>